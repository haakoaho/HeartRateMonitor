# Health Application
10 hour project designed to demonstrate programming capability of designing a fullstack application.

- [Health Application](#health-application)
  - [Introudction](#introudction)
  - [Installation](#installation)
    - [Database](#database)
    - [Integration Test](#integration-test)
    - [API](#api)
    - [APP](#app)
  - [Details of solution](#details-of-solution)
    - [Database](#database-1)
    - [API](#api-1)
    - [Mobile Application](#mobile-application)
    - [Integration Test](#integration-test-1)

## Introudction
The purpose of this app is to measure the heart rate of a person. The user registers with a unique username, they will then be given a user id to store all their records. The data is stored in a database, so that when GDPR is implemented, the users can give consent to share their data with health personel so it becomes easier for them to detect diseases early. 

The implemnted solution is a full stack mobile application with a postgreSQL database, ASP[]().NET API layer, with a Xamarin.Forms mobile applcation in the UI layer. 

## Installation 

### Database
Install [PostgreSQL](https://www.postgresql.org/download/) with PGAdmin. If postgres was installed, you should have a server called postgres. Create two database there with the names "health_db_local" and "health_db_local_test". Running the API will create tables from health_db_local. Running the Tests will create tables for health_db_local_test. 

### Integration Test
Make sure PostgreSQL is running. In Visual Studio, open Heart Monitor API. Right click the "Hear Monitor API Test" solution, then choose, "run all tests". 

### API 
In Visual Studio, open Heart Monitor API. For the mobile application to connect, you need to find your IP adress, then replace it in the applicationUrl property inside the Properties/launchSettings.json file: 
```JSON
"Heart_Monitor_API": {
      "commandName": "Project",
      "launchBrowser": true,
      "launchUrl": "swagger",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      },
      "dotnetRunMessages": "true",
      "applicationUrl": "https://localhost:5001;https://{YOUR_IP_ADRESS}:5001;"
    },
```

Launch it as Heart_Monitor_API if  you are testing with app. Swagger documentation will be available, but all functionality is documented here.


### APP
In Visual Studio, Open HeartRate app. You have to do some configuration in code for the app to be able to run. In the backend folder, you will find a class called "APIModule" which is responsible for connecting to the API.  Edit this URL to your address.

```C#
 class APIModule
    {
        private const string url = "https://{YOUR_IP_ADRESS}";

```

 then launch for Android. iOS may work but has not been tested. 

## Details of solution

### Database
The database has two tables, heart_rate and users. users table has two fields:user_id and username. user_id is the primary key and will never change. User_id is autogenerated.  Username field is unique, but can maybe change in a future implementation. heart_rate has five fields: an autogenerated record_id, user_id which is a foreign key to users table, the two pressures, and a creation timestamp that is automatically generated on the creation of the record. 

### API 
There is five calls in the api 

Creating a new user:
```
POST {domain}/User?username=a
```
Getting userId from username:
```
GET {domain}/User?username=a
```

Creating new Heart Rate Record:
```
POST /HeartRate
```
With Reques body:
```JSON
{
  "userId": 0,
  "systolicPressure": 0,
  "arterisPressure": 0
}
```

Getting all Heart Rate Records for a user:
```
GET {domain}/HeartRate?userId=1
```
Delete a heart rate record:
```
DELTE {domain}/HeartRate?recordId=1
```




### Mobile Application
The user can register with a username from the login screen. The app will call the API to register that name in the databse. Exception will be thrown if user already exists. Exception is not handled. 

![picture]("Images/login.jpg")

Authentication is not yet implemented so users only provide username. User can log in with the same username after registering.  User will get to this screen. 

![picture]("Images/main.jpg")

The user can add Heart Rate Records. Heart Rate records are measured by generating random values. Heart Rate Records are stored in the database for the user Id. 

After the next call to the database, the record will be listed, with the most recently created record at the top. If Heart Rate is too high, warnings will be shown to the user. 

![picture]("Images/mainRecord.jpg")

![picture]("Images/GoodRecord.jpg")

![picture]("Images/BadRecord.jpg)


The user can also delete records, where they will be deleted from the database. 


### Integration Test
There is an integration test between the database and the API, as that is the most critical part of the application. It uses a fake database which has the same table struture as the real database, then does some insertions and deletions and checks if it works as expected. 